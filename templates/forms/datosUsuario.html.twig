<h1>Editar tu información</h1>

<form method="POST">
    <div class="form-group">
        <label for="username">Nombre de Usuario</label>
        <input type="text" id="username" name="username" class="form-control" value="{{ app.user.username }}" required>
    </div>

    <div class="form-group">
        <label for="email">Correo Electrónico</label>
        <input type="email" id="email" name="email" class="form-control" value="{{ app.user.email }}" required>
    </div>

    <div class="form-group">
        <label for="password">Contraseña</label>
        <input type="password" id="password" name="password" class="form-control" placeholder="Deja vacío para no cambiar">
    </div>

    <div class="form-group">
        <label for="roles">Roles</label>
        <input type="text" id="roles" class="form-control" value="{{ app.user.roles|join(', ') }}" disabled>
    </div>

    <button type="submit" class="btn btn-primary">Guardar cambios</button>
</form>

{% if 'ROLE_STATS' not in app.user.roles and app.user.peticionRol|filter(p => p.status.value == 'PENDING')|length == 0 %}
    <button id="solicitar-stats" class="btn btn-secondary mt-3">
        Solicitar rol de Estadista
    </button>

    <script>
        $('#solicitar-stats').on('click', function() {
            if (confirm("¿Quieres solicitar el rol de Estadista?")) {
                $.post('/usuario/{{ app.user.id }}/peticion-rol', function() {
                    alert('Solicitud enviada. Espera aprobación.');
                    location.reload();
                });
            }
        });
    </script>
{% endif %}
{% set peticion = app.user.peticionRol|first %}
{% if peticion %}
    <div>
        {% if peticion.status.value == 'PENDING' %}
            <span class="text-warning mt-3">Tienes una solicitud pendiente.</span>
        {% elseif peticion.status.value == 'APPROVED' %}
            <span class="text-success mt-3">Tu solicitud fue aprobada.</span>
        {% elseif peticion.status.value == 'REJECTED' %}
            <span class="text-danger mt-3">Tu solicitud fue rechazada.</span>
        {% endif %}
    </div>

{% endif %}

